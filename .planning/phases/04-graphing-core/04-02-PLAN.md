---
phase: 04-graphing-core
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - src/App.tsx
  - src/components/Calculator.tsx
  - src/styles/Calculator.css
autonomous: false

must_haves:
  truths:
    - "User can enter a function expression in a dedicated graph input field"
    - "Pressing Plot (or Enter) renders the function curve on the graph"
    - "User can clear the graph and enter a new function expression"
    - "Graph respects current DEG/RAD angle mode for trigonometric functions"
    - "Graph panel appears below the calculator buttons area"
  artifacts:
    - path: "src/App.tsx"
      provides: "Graph state management (graphExpression, graphVisible)"
    - path: "src/components/Calculator.tsx"
      provides: "Graph input field, plot/clear buttons, GraphPanel integration"
    - path: "src/styles/Calculator.css"
      provides: "Graph input and control button styles"
  key_links:
    - from: "src/App.tsx"
      to: "src/components/Calculator.tsx"
      via: "graphExpression, angleMode props passed down"
      pattern: "graphExpression"
    - from: "src/components/Calculator.tsx"
      to: "src/components/GraphPanel.tsx"
      via: "GraphPanel rendered with expression and angleMode"
      pattern: "<GraphPanel"
---

<objective>
Integrate the graph panel into the calculator UI with a dedicated input field for function expressions, plot/clear controls, and angle mode pass-through.

Purpose: Without UI integration, users cannot enter functions or see graphs. This plan connects the rendering engine (04-01) to the user interface, completing all Phase 4 success criteria.
Output: Updated App.tsx with graph state, updated Calculator.tsx with graph input/controls, updated CSS with graph input styles.
</objective>

<execution_context>
@/Users/angel-ai/.claude/get-shit-done/workflows/execute-plan.md
@/Users/angel-ai/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-graphing-core/04-01-SUMMARY.md
@src/App.tsx
@src/components/Calculator.tsx
@src/components/GraphPanel.tsx
@src/styles/Calculator.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add graph state management and UI controls</name>
  <files>src/App.tsx, src/components/Calculator.tsx, src/styles/Calculator.css</files>
  <action>
**State in App.tsx:**

Add new state variables:
```typescript
const [graphExpression, setGraphExpression] = useState('');   // The plotted expression
const [graphInputValue, setGraphInputValue] = useState('');   // Current input field value
const [graphVisible, setGraphVisible] = useState(false);      // Whether graph panel is shown
```

Add handlers:
- `handleGraphPlot` — Sets `graphExpression` to `graphInputValue` and `graphVisible` to true. Only plots if input is non-empty.
- `handleGraphClear` — Sets `graphExpression` to '', `graphInputValue` to '', `graphVisible` to false.
- `handleGraphInputChange` — Sets `graphInputValue` from input event.
- `handleGraphInputKeyDown` — On Enter key, calls `handleGraphPlot`.

Pass these to Calculator as props: `graphExpression`, `graphInputValue`, `graphVisible`, `onGraphPlot`, `onGraphClear`, `onGraphInputChange`, `onGraphInputKeyDown`, `angleMode` (already passed).

**Calculator.tsx updates:**

Add to CalculatorProps interface:
```typescript
graphExpression: string;
graphInputValue: string;
graphVisible: boolean;
onGraphPlot: () => void;
onGraphClear: () => void;
onGraphInputChange: (e: React.ChangeEvent<HTMLInputElement>) => void;
onGraphInputKeyDown: (e: React.KeyboardEvent<HTMLInputElement>) => void;
```

Add graph section below the history panel (or above it — place it between the button panels and history). Layout:

```jsx
<div className="graph-controls">
  <div className="graph-controls__input-row">
    <span className="graph-controls__label">y =</span>
    <input
      className="graph-controls__input"
      type="text"
      value={graphInputValue}
      onChange={onGraphInputChange}
      onKeyDown={onGraphInputKeyDown}
      placeholder="f(x), e.g. sin(x)"
      data-testid="graph-input"
    />
  </div>
  <div className="graph-controls__buttons">
    <button className="graph-controls__btn graph-controls__btn--plot" onClick={onGraphPlot}>
      Plot
    </button>
    <button className="graph-controls__btn graph-controls__btn--clear" onClick={onGraphClear}>
      Clear
    </button>
  </div>
</div>
<GraphPanel
  expression={graphExpression}
  angleMode={angleMode}
  visible={graphVisible}
/>
```

Import GraphPanel at top of Calculator.tsx (it was created in plan 04-01).

**IMPORTANT:** The graph input field is a native HTML input, NOT the calculator's expression input. It should NOT trigger the keyboard hook (useKeyboardInput). The existing keyboard hook in `useKeyboardInput.ts` already checks `document.activeElement?.tagName` and ignores events when an input/textarea is focused — verify this guard exists. If it does, the graph input will work without conflict.

**CSS additions to Calculator.css:**

```css
/* Graph Controls */
.graph-controls {
  margin-top: 12px;
  border-top: 1px solid #3a3a3a;
  padding-top: 10px;
}

.graph-controls__input-row {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-bottom: 8px;
}

.graph-controls__label {
  color: #888;
  font-family: monospace;
  font-size: 0.9rem;
  flex-shrink: 0;
}

.graph-controls__input {
  flex: 1;
  background: #3a3a3a;
  border: 1px solid #555;
  border-radius: 6px;
  color: #fff;
  font-family: monospace;
  font-size: 0.9rem;
  padding: 8px 10px;
  outline: none;
  transition: border-color 0.15s;
}

.graph-controls__input:focus {
  border-color: #4a9eff;
}

.graph-controls__input::placeholder {
  color: #666;
}

.graph-controls__buttons {
  display: flex;
  gap: 6px;
}

.graph-controls__btn {
  flex: 1;
  padding: 8px 12px;
  border: none;
  border-radius: 6px;
  font-size: 0.85rem;
  cursor: pointer;
  font-family: inherit;
  transition: background-color 0.1s;
}

.graph-controls__btn--plot {
  background: #4a9eff;
  color: #fff;
}

.graph-controls__btn--plot:hover {
  background: #5aafff;
}

.graph-controls__btn--clear {
  background: #4a4a4a;
  color: #ccc;
}

.graph-controls__btn--clear:hover {
  background: #5a5a5a;
}
```

Add responsive overrides:
- Phone (max-width 480px): reduce padding, smaller font
- Narrow phone (max-width 340px): further reduce sizes

**Angle mode integration:** The `angleMode` state already exists in App.tsx and is passed through. GraphPanel receives it and passes to renderGraph. When user toggles DEG/RAD, React will re-render GraphPanel with new angleMode, triggering useEffect to re-render the graph. No additional wiring needed.
  </action>
  <verify>Run `npm run build` — no TypeScript errors. Run `npm test` — all tests pass (including existing ones). Run `npm run dev` and verify in browser: graph input field appears, typing a function and pressing Plot draws the graph, Clear removes it.</verify>
  <done>Graph input field with "y =" label and placeholder visible below calculator buttons. Plot button triggers graph rendering. Clear button removes graph and resets input. Angle mode toggle re-renders graph with correct trig values. Graph renders with axes, grid, labels, and function curve.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify graph plotting end-to-end</name>
  <files>src/components/Calculator.tsx</files>
  <action>
Human verification checkpoint. What was built: Complete graphing feature — input field, plot/clear controls, Canvas-based graph with axes, grid, labels, and function curve rendering. Angle mode (DEG/RAD) support for trig functions.

How to verify:
1. Run `npm run dev` and open the calculator in browser
2. Locate the graph input field below the calculator buttons (should show "y =" label and placeholder "f(x), e.g. sin(x)")
3. Type `x^2` in the input field and click "Plot"
   - Expected: A parabola appears on the graph with grid lines, labeled axes, and tick marks
4. Click "Clear" — graph disappears and input field resets
5. Type `sin(x)` and press Enter
   - Expected: A sine wave appears on the graph
6. Toggle angle mode to RAD (if currently DEG) or DEG (if currently RAD)
   - Expected: The sine wave changes shape (DEG mode: very compressed, RAD mode: normal wave)
7. Type `1/x` and press Enter
   - Expected: Hyperbola with gap at x=0 (discontinuity handled)
8. Check responsive: resize browser to phone width (~375px)
   - Expected: Graph and controls scale properly

Resume signal: Type "approved" or describe issues to fix
  </action>
  <verify>User visually confirms all 8 verification steps pass</verify>
  <done>User has approved the complete graphing feature including input, plotting, clearing, angle mode, and responsive layout</done>
</task>

</tasks>

<verification>
1. `npm test` — all existing and new tests pass
2. `npm run build` — no TypeScript compilation errors
3. Graph input field accepts function expressions
4. Plot button renders function on Canvas
5. Clear button resets graph and input
6. DEG/RAD toggle affects trig function rendering on graph
7. Responsive layout works on tablet and phone widths
</verification>

<success_criteria>
- User can type a function expression in the dedicated "y = ..." input field
- Clicking Plot (or pressing Enter) renders the function as a curve on a Canvas graph
- Graph shows labeled axes with tick marks and grid lines
- Clear button removes the graph and resets the input
- Graph respects current DEG/RAD angle mode for trig functions
- All Phase 4 success criteria met
</success_criteria>

<output>
After completion, create `.planning/phases/04-graphing-core/04-02-SUMMARY.md`
</output>
