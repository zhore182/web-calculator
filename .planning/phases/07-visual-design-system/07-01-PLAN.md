---
phase: 07-visual-design-system
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/styles/design-tokens.css
  - src/styles/Calculator.css
  - src/index.css
  - src/main.tsx
autonomous: true

must_haves:
  truths:
    - "All UI elements reference design tokens instead of hardcoded values"
    - "Color palette is consistent — no orphan hex values outside tokens"
    - "Typography sizes follow a defined scale"
    - "Spacing and border-radius use token values throughout"
  artifacts:
    - path: "src/styles/design-tokens.css"
      provides: "CSS custom properties for colors, typography, spacing, border-radius"
      contains: "--color-"
    - path: "src/styles/Calculator.css"
      provides: "All component styles using design tokens"
      contains: "var(--"
    - path: "src/index.css"
      provides: "Global styles using design tokens"
      contains: "var(--"
  key_links:
    - from: "src/main.tsx"
      to: "src/styles/design-tokens.css"
      via: "import statement"
      pattern: "import.*design-tokens"
    - from: "src/styles/Calculator.css"
      to: "src/styles/design-tokens.css"
      via: "CSS custom property references"
      pattern: "var\\(--"
---

<objective>
Create a design token system using CSS custom properties and refactor all existing styles to use tokens instead of hardcoded values.

Purpose: Establish the visual foundation that phases 8-11 depend on. All future UI components will reference these tokens for consistent styling.
Output: Design tokens file with color palette, typography scale, spacing scale, and border-radius tokens. All existing CSS refactored to use them.
</objective>

<execution_context>
@/Users/angel-ai/.claude/get-shit-done/workflows/execute-plan.md
@/Users/angel-ai/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/styles/Calculator.css
@src/index.css
@src/main.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create design tokens CSS file</name>
  <files>src/styles/design-tokens.css, src/main.tsx</files>
  <action>
Create `src/styles/design-tokens.css` with CSS custom properties on `:root`. Extract and systematize all current hardcoded values into a coherent design system.

**Color palette** — derive from current colors, organized by semantic role:
- Surface colors: `--color-bg-primary` (#1a1a1a body), `--color-bg-secondary` (#2c2c2c calculator), `--color-bg-tertiary` (#3a3a3a inputs/panels), `--color-bg-elevated` (#4a4a4a buttons)
- Text colors: `--color-text-primary` (#ffffff), `--color-text-secondary` (#ccc/#aaa), `--color-text-muted` (#888), `--color-text-disabled` (#555/#666)
- Accent colors: `--color-accent-primary` (#4a9eff blue), `--color-accent-secondary` (#ff9500 orange), `--color-accent-danger` (#ff6b6b red)
- Button-specific: `--color-btn-default` (#4a4a4a), `--color-btn-default-hover` (#5a5a5a), `--color-btn-default-active` (#3a3a3a), `--color-btn-operator` (#ff9500), `--color-btn-operator-hover` (#ffaa33), `--color-btn-clear` (#a5a5a5), `--color-btn-clear-hover` (#b5b5b5), `--color-btn-memory` (#3a5a3a), `--color-btn-memory-hover` (#4a6a4a), `--color-btn-scientific` (#3a4a5a), `--color-btn-scientific-hover` (#4a5a6a), `--color-btn-scientific-active` (#2a3a4a)
- Display: `--color-display-bg` (#4a5a3a), `--color-display-text` (#1a1a1a)
- Graph: `--color-graph-bg` (#1a1a1a), `--color-graph-plot` (#4a9eff)

**Typography scale** (based on current values, systematized):
- `--font-family-primary`: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif
- `--font-family-mono`: 'Courier New', monospace
- `--font-size-xs`: 0.7rem (badges, tiny labels)
- `--font-size-sm`: 0.8rem (scientific buttons, history)
- `--font-size-md`: 0.9rem (inputs, controls)
- `--font-size-base`: 1rem (expression display)
- `--font-size-lg`: 1.25rem (buttons)
- `--font-size-xl`: 1.5rem (small result)
- `--font-size-2xl`: 2rem (mobile result)
- `--font-size-3xl`: 2.5rem (desktop result)

**Spacing scale** (4px base unit):
- `--space-1`: 4px
- `--space-2`: 6px
- `--space-3`: 8px
- `--space-4`: 10px
- `--space-5`: 12px
- `--space-6`: 16px
- `--space-7`: 20px
- `--space-8`: 24px

**Border radius**:
- `--radius-sm`: 3px
- `--radius-md`: 4px
- `--radius-base`: 6px
- `--radius-lg`: 8px
- `--radius-xl`: 12px

**Shadows**:
- `--shadow-lg`: 0 8px 24px rgba(0, 0, 0, 0.3)

**Transitions**:
- `--transition-fast`: 0.1s
- `--transition-normal`: 0.15s
- `--transition-slow`: 0.25s

Then add `import './styles/design-tokens.css'` as the FIRST import in `src/main.tsx` (before `index.css`) so tokens are available globally.
  </action>
  <verify>
Run `npx vite build` — build succeeds with no CSS errors. Grep `src/styles/design-tokens.css` for `--color-`, `--font-size-`, `--space-`, `--radius-` to confirm all token categories present.
  </verify>
  <done>Design tokens file exists with all color, typography, spacing, radius, shadow, and transition tokens. Imported in main.tsx before other styles.</done>
</task>

<task type="auto">
  <name>Task 2: Refactor all CSS to use design tokens</name>
  <files>src/styles/Calculator.css, src/index.css</files>
  <action>
Replace every hardcoded color, font-size, spacing, border-radius, box-shadow, and transition-duration value in `Calculator.css` and `index.css` with the corresponding `var(--token)` reference.

**index.css changes:**
- `background: #1a1a1a` → `background: var(--color-bg-primary)`
- `font-family: -apple-system...` → `font-family: var(--font-family-primary)`
- `padding: 8px` → `padding: var(--space-3)`

**Calculator.css systematic replacement rules:**

Colors — replace ALL hex values and rgba values with corresponding token:
- `#2c2c2c` → `var(--color-bg-secondary)` (calculator bg)
- `#3a3a3a` → `var(--color-bg-tertiary)` (mode toggle bg, borders, inputs)
- `#4a4a4a` → `var(--color-btn-default)` (default buttons, active toggle)
- `#5a5a5a` → `var(--color-btn-default-hover)` (hover states)
- `#ff9500` → `var(--color-btn-operator)` (operator/equals buttons)
- `#ffaa33` → `var(--color-btn-operator-hover)`
- `#a5a5a5` → `var(--color-btn-clear)`
- `#b5b5b5` → `var(--color-btn-clear-hover)`
- `#4a9eff` → `var(--color-accent-primary)` (blue accents)
- `#ff6b6b` → `var(--color-accent-danger)` (danger/clear history)
- `#888` → `var(--color-text-muted)`
- `#aaa` → `var(--color-text-secondary)`
- `#ccc` → `var(--color-text-secondary)` (where used for lighter text)
- `#fff`/`#ffffff` → `var(--color-text-primary)` (where used as text)
- `#1a1a1a` → `var(--color-bg-primary)` (where used as bg) or `var(--color-display-text)` (in display)
- Display bg `#4a5a3a` → `var(--color-display-bg)`
- Scientific buttons `#3a4a5a` → `var(--color-btn-scientific)`
- Memory buttons `#3a5a3a` → `var(--color-btn-memory)`

Font sizes — replace with scale tokens:
- `2.5rem` → `var(--font-size-3xl)`
- `2rem` → `var(--font-size-2xl)`
- `1.5rem` → `var(--font-size-xl)`
- `1.25rem` → `var(--font-size-lg)`
- `1rem` → `var(--font-size-base)`
- `0.9rem` → `var(--font-size-md)`
- `0.85rem` → `var(--font-size-sm)` (close enough to 0.8)
- `0.8rem` → `var(--font-size-sm)`
- `0.75rem` → `var(--font-size-xs)` (close enough to 0.7)
- `0.7rem` → `var(--font-size-xs)`
- For mobile overrides, use smaller token values (e.g., `--font-size-lg` → `--font-size-base`)

Spacing — replace with tokens where values match:
- `4px` → `var(--space-1)`
- `6px` → `var(--space-2)`
- `8px` → `var(--space-3)`
- `10px` → `var(--space-4)`
- `12px` → `var(--space-5)`
- `16px` → `var(--space-6)`
- `20px` → `var(--space-7)`
- Note: Keep pixel-specific layout values that aren't part of the spacing rhythm (e.g., `width: 24px` for icon buttons, `height: 200px` for graph canvas) as-is. Only spacing (padding, margin, gap) should use tokens.

Border radius — replace with tokens:
- `3px` → `var(--radius-sm)`
- `4px` → `var(--radius-md)`
- `6px` → `var(--radius-base)`
- `8px` → `var(--radius-lg)`
- `12px` → `var(--radius-xl)`

Box shadow — replace:
- `0 8px 24px rgba(0, 0, 0, 0.3)` → `var(--shadow-lg)`

Transitions — replace duration values:
- `0.1s` → `var(--transition-fast)`
- `0.15s` → `var(--transition-normal)`
- `0.25s` → `var(--transition-slow)`

**Critical constraints:**
- Do NOT change any values — only replace hardcoded values with `var()` references to the exact same values defined in tokens
- Keep all responsive breakpoints and their overrides — mobile overrides may use different tokens or keep some hardcoded values where the token mapping would be confusing
- For rgba() values used as semi-transparent overlays (e.g., `rgba(255, 255, 255, 0.05)`), keep them as-is since they're opacity variants, not in the token palette. Only replace fully-opaque hex colors.
- The `font-family: monospace` references in Calculator.css should use `var(--font-family-mono)`
- The `font-family: inherit` references should stay as `inherit`
  </action>
  <verify>
1. Run `npx vite build` — must succeed with zero errors
2. Run `grep -c 'var(--' src/styles/Calculator.css` — expect 100+ token references
3. Run `grep -cE '#[0-9a-fA-F]{3,6}' src/styles/Calculator.css` — expect very few remaining hex values (only in rgba or media-query-specific overrides that don't map cleanly)
4. Run `npm test` — all 192 tests still pass (styling changes shouldn't affect logic tests, but verify no import breaks)
  </verify>
  <done>All Calculator.css and index.css hardcoded values replaced with design token references. Build succeeds. Visual output is pixel-identical to before (same values, just referenced via tokens). Tests pass.</done>
</task>

</tasks>

<verification>
1. `npx vite build` succeeds — no CSS parse errors from var() references
2. `npm test` — all tests pass
3. `grep -rn 'var(--' src/styles/` confirms token usage throughout
4. `grep -c ':root' src/styles/design-tokens.css` returns 1 (single root block)
5. No visual changes — same values, just tokenized
</verification>

<success_criteria>
- Design tokens file defines all color, typography, spacing, radius, shadow, and transition tokens
- Calculator.css uses var() references instead of hardcoded values throughout
- index.css uses var() references instead of hardcoded values
- Build succeeds and all tests pass
- Token file is imported before other CSS in main.tsx
</success_criteria>

<output>
After completion, create `.planning/phases/07-visual-design-system/07-01-SUMMARY.md`
</output>
